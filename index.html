<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaflet Map with Shapefile</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <style>
      #map {
        height: 100vh;
      }
      .leaflet-control-layers {
        background: white;
        padding: 10px;
      }
      .custom-legend {
        position: absolute;
        bottom: 30px;
        left: 30px;
        background: white;
        padding: 10px;
        border: 2px solid #ccc;
      }
      .custom-legend button {
        display: block;
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Leaflet Omnivore JS -->
    <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>

    <script>
      // Initialize the map
      var map = L.map("map").setView([45.2671, 19.8335], 13);

      // Define base layers
      var osmLayer = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }
      );

      var satelliteLayer = L.tileLayer(
        "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",
        {
          maxZoom: 17,
          attribution:
            '&copy; <a href="https://www.opentopomap.org">OpenTopoMap</a> contributors',
        }
      );

      // Add OSM layer to map
      osmLayer.addTo(map);

      // Create a layer control and add to map
      var baseLayers = {
        OpenStreetMap: osmLayer,
        Satellite: satelliteLayer,
      };

      L.control.layers(baseLayers).addTo(map);

      // Add custom legend
      var legend = L.control({ position: "bottomleft" });

      legend.onAdd = function (map) {
        var div = L.DomUtil.create("div", "custom-legend");
        div.innerHTML =
          "<button onclick=\"switchLayer('osm')\">OSM</button><button onclick=\"switchLayer('sat')\">Satellite</button>";
        return div;
      };

      legend.addTo(map);

      // Switch layer function
      function switchLayer(layer) {
        if (layer === "osm") {
          map.addLayer(osmLayer);
          map.removeLayer(satelliteLayer);
        } else if (layer === "sat") {
          map.addLayer(satelliteLayer);
          map.removeLayer(osmLayer);
        }
      }

      // Load and display shapefile
      omnivore
        .shapefile("shp/Parcels.shp")
        .on("ready", function () {
          map.fitBounds(this.getBounds());
        })
        .addTo(map);
    </script>
  </body>
</html>
